import 'package:flutter/material.dart';
import 'edit_profile_page.dart';
import '../services/api_service.dart';

class Profile extends StatefulWidget {
  const Profile({super.key});

  @override
  State<Profile> createState() => _ProfileState();
}

class _ProfileState extends State<Profile> {
  final ApiService _apiService = ApiService();
  String firstName = '';
  String lastName = '';
  String email = '';
  int userId = 1; // Set this based on your app's login logic

  @override
  void initState() {
    super.initState();
    _loadUserProfile();
  }

  Future<void> _loadUserProfile() async {
    try {
      final profile = await _apiService.fetchProfile(userId);
      setState(() {
        firstName = profile['name']['firstname'] ?? '';
        lastName = profile['name']['lastname'] ?? '';
        email = profile['email'] ?? '';
      });
    } catch (e) {
      debugPrint("Error fetching user profile: $e");
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text("My Profile", style: TextStyle(color: Colors.black)),
        backgroundColor: Colors.white,
        elevation: 0,
        leading: IconButton(
          icon: const Icon(Icons.arrow_back, color: Colors.black),
          onPressed: () => Navigator.pop(context),
        ),
      ),
      backgroundColor: Colors.white,
      body: Column(
        children: [
          const SizedBox(height: 10),
          const CircleAvatar(radius: 45, backgroundImage: AssetImage("assets/profile.jpg")),
          const SizedBox(height: 10),
          Text(
            "$firstName $lastName",
            style: const TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
          ),
          Text(
            email,
            style: const TextStyle(color: Colors.grey),
          ),
          const SizedBox(height: 10),
          ElevatedButton(
            onPressed: () => Navigator.push(
              context,
              MaterialPageRoute(builder: (context) => const EditProfilePage()),
            ).then((_) => _loadUserProfile()), // Refresh data after editing
            style: ElevatedButton.styleFrom(backgroundColor: const Color(0xFF007BFF)),
            child: const Text("Edit Profile"),
          ),
        ],
      ),
    );
  }
}
